# Reglas de Cursor para SaaS MT Marketplace Admin

## Contexto del Proyecto
Portal de super administraci√≥n para gestionar el marketplace completo de "Tienda Vecina". Permite administrar tenants, cat√°logo global, templates de quickstart y configuraciones del sistema.

**Puerto de desarrollo**: 3004

## Stack Tecnol√≥gico
- **Framework**: Next.js 15 con App Router
- **Lenguaje**: TypeScript
- **Styling**: Tailwind CSS + Radix UI
- **Tablas**: TanStack Table
- **Themes**: Sistema de 3 temas (light/dark/dim)

## Comandos de Desarrollo

```bash
npm run dev              # Puerto 3004 con Turbopack
npm run dev:webpack      # Puerto 3004 con Webpack tradicional
npm run build            # Build producci√≥n
npm run build:analyze    # Build con an√°lisis bundle
npm start               # Servidor producci√≥n
npm test                # Tests
npm run lint            # ESLint
npm run clean           # Limpiar cache
```

## REGLA: USAR MCP FRONTEND INTEGRATOR PRIMERO

**SIEMPRE** antes de crear/modificar componentes, consultar MCP:

```bash
# Analizar componentes marketplace-admin
analyze_components --frontend="marketplace-admin"

# Detectar duplicados entre frontends
detect_duplicates --frontend="marketplace-admin"

# Clasificar componente espec√≠fico
classify_component --component_path="services/saas-mt-marketplace-admin/components/forms/business-type-form.tsx"

# Inventario completo
get_component_inventory --frontend="marketplace-admin"

# Patrones del sistema
analyze_patterns --frontend="marketplace-admin"
```

## Arquitectura de Comunicaci√≥n

### Patr√≥n API Proxy
Frontend ‚Üí Rutas locales ‚Üí Kong Gateway ‚Üí Microservicios

```typescript
// Frontend: GET /api/pim/marketplace-brands  
// Proxy a: http://localhost:8001/pim/api/v1/marketplace/brands
```

### Headers Autom√°ticos
- `Authorization: Bearer <token>`
- `X-Tenant-ID: <uuid>`  
- `X-User-Role: marketplace_admin`

## Servicios Backend Integrados

### Kong Gateway (Puerto 8001)
- **IAM Service**: `/iam/api/v1/*`
- **PIM Service**: `/pim/api/v1/*`  
- **Stock Service**: `/stock/api/v1/*`

### Endpoints Implementados
```http
# IAM
/api/pim/tenants
/api/pim/roles
/api/pim/plans

# PIM Marketplace (Administraci√≥n Global)
/api/pim/marketplace-categories
/api/pim/marketplace-brands
/api/pim/marketplace-attributes
/api/pim/global-catalog
/api/pim/business-types
/api/pim/business-type-templates
```

## Sistema de Componentes Atomic Design

### Estructura
```
src/components/shared-ui/
‚îú‚îÄ‚îÄ atoms/          # Botones, inputs, badges
‚îú‚îÄ‚îÄ molecules/      # Searchable selects, cards
‚îú‚îÄ‚îÄ organisms/      # Tablas, sidebars, formularios
‚îî‚îÄ‚îÄ templates/      # Layouts de p√°gina
```

### Convenciones
- **Archivos**: `kebab-case.tsx`
- **Componentes**: `PascalCase`
- **Props**: `<ComponentName>Props`
- **Clases**: usar `cn()` para merge Tailwind

## Estado Actual: PASO 0 - Quickstart 75% Completado

### ‚úÖ Completado
- CRUD Business Types
- CRUD Business Type Templates
- CRUD Marketplace Categories (taxonom√≠a)
- CRUD Marketplace Brands
- CRUD Marketplace Attributes
- Global Catalog b√°sico
- Sistema de componentes shared-ui

### üîÑ En Desarrollo
- Wizard UI para quickstart
- Integraci√≥n con selecci√≥n de templates
- Proceso de importaci√≥n al tenant

### ‚ùå Pendiente
- Validaci√≥n end-to-end completa
- M√©tricas de uso del quickstart

## Patrones de Desarrollo

### API Client Pattern
```typescript
import { marketplaceApi } from '@/lib/api';

const response = await marketplaceApi.getAllMarketplaceBrands({
  page: 1,
  page_size: 20
});
```

### Custom Hooks Pattern
```typescript
export function useMarketplaceBrands(filters) {
  const [brands, setBrands] = useState([]);
  const [loading, setLoading] = useState(true);
  // L√≥gica de carga...
  return { brands, loading, error };
}
```

### Server/Client Components
- Por defecto: Server Components
- Client Components: solo con interactividad/hooks
- Marcar con `'use client'` al inicio

### Manejo de Errores
```typescript
const response = await marketplaceApi.someMethod();
if (response.error) {
  toast.error(response.error);
  return;
}
// Procesar response.data
```

## Estructura de Archivos

```
src/
‚îú‚îÄ‚îÄ app/                    # App Router Next.js
‚îÇ   ‚îú‚îÄ‚îÄ api/pim/           # API Routes proxy
‚îÇ   ‚îú‚îÄ‚îÄ (p√°ginas)          # P√°ginas de la aplicaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx         # Layout con providers
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ shared-ui/         # Atomic Design
‚îÇ   ‚îú‚îÄ‚îÄ forms/             # Formularios espec√≠ficos
‚îÇ   ‚îî‚îÄ‚îÄ layout/            # Componentes de layout
‚îú‚îÄ‚îÄ hooks/                 # Custom hooks
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts            # Cliente API singleton
‚îÇ   ‚îú‚îÄ‚îÄ types/            # Interfaces TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ config.ts         # Configuraci√≥n app
‚îî‚îÄ‚îÄ config/               # Configuraciones est√°ticas
```

## Multi-Tenancy y Roles

### Super Admin Features
- Gesti√≥n completa de tenants
- Configuraci√≥n del cat√°logo global
- Creaci√≥n de business types y templates
- Monitoreo del sistema

### Validation Rules
- Header `X-User-Role: marketplace_admin`
- Verificaci√≥n de permisos en cada endpoint
- Datos aislados por tenant cuando corresponde

## Configuraciones Importantes

### Puerto de Desarrollo: 3004
Evita conflictos con otros frontends:
- Backoffice: 3000
- Marketplace Frontend: 3005

### Optimizaciones Next.js
- Turbopack para desarrollo r√°pido
- Standalone output para Docker
- Transpilaci√≥n de librer√≠as internas

### Docker Multi-stage
- `deps`: Instalaci√≥n dependencias
- `builder`: Build aplicaci√≥n
- `development`: Imagen con hot reload
- `production`: Imagen distroless optimizada

## Flujo de Trabajo T√≠pico

1. **Nueva Feature**: Crear p√°gina en `app/`, componentes en `shared-ui/`
2. **API Integration**: Agregar m√©todos en `lib/api.ts`
3. **Forms**: React Hook Form + Zod para validaci√≥n
4. **Tables**: TanStack Table con componente `Table` base
5. **Testing**: Tests en `__tests__/` con Jest

## Sistema de Themes

### Themes Disponibles
- **Light**: Tema claro por defecto
- **Dark**: Tema oscuro  
- **Dim**: Tema intermedio

### CSS Variables
Variables en `globals.css`, aplicadas con `next-themes`:
```css
:root {
  --background: 0 0% 100%;
  --foreground: 240 10% 3.9%;
  /* ... m√°s variables */
}

.dark {
  --background: 240 10% 3.9%;
  --foreground: 0 0% 98%;
  /* ... variables para dark */
}
```

## Consideraciones de Performance

### Bundle Optimization
- Code splitting autom√°tico con Next.js
- Tree shaking de librer√≠as no usadas
- Imagen optimizada con `next/image`

### API Optimization  
- Paginaci√≥n obligatoria en listados
- Filtros eficientes con criteria pattern
- Cache de respuestas frecuentes

## Debugging y Monitoreo

### Development Tools
- React DevTools para componentes
- Network tab para API calls
- Console logs estructurados

### Error Boundaries
- Captura de errores a nivel de p√°gina
- Fallbacks informativos para usuarios
- Logging de errores para debugging

## Variables de Entorno

```bash
# Desarrollo
NEXT_PUBLIC_API_URL=http://localhost:8001

# Producci√≥n  
NEXT_PUBLIC_API_URL=https://api.tiendavecina.com
```

## Convenciones de Naming

- **P√°ginas**: `snake_case.tsx` en app/
- **Componentes**: `PascalCase` en shared-ui/
- **Hooks**: `camelCase` con prefijo `use`
- **Types**: `PascalCase` con sufijos descriptivos
- **APIs**: `camelCase` con sufijo `Api`

## Consideraciones Importantes

- **Multi-tenant**: Todos los datos aislados por `tenant_id`
- **Roles**: Verificar permisos con `X-User-Role`
- **Performance**: Usar paginaci√≥n en listados
- **UX**: Mantener consistencia con design system
- **Errores**: Toast notifications claras

**Estado**: 75% completado, enfoque en finalizar wizard de quickstart
